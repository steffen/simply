/* Dark minimalist theme */
:root{
  --bg: #0f1216;
  --panel: #151a21;
  --panel-2: #1b212a;
  --text: #e6e8eb;
  --muted: #a4acb7;
  --accent: #6ea8fe;
  --accent-2: #4c8dff;
  --danger: #ff6b6b;
  --border: #232a34;
  --shadow: 0 6px 24px rgba(0,0,0,0.35), 0 2px 8px rgba(0,0,0,0.35);
  --radius: 14px;
}

*{ box-sizing: border-box; }
html, body{
  height:100%;
}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, Noto Sans, "Apple Color Emoji", "Segoe UI Emoji";
  background: radial-gradient(1200px 800px at 10% -10%, #121720, transparent),
              radial-gradient(1200px 800px at 110% 110%, #0b0f16, transparent),
              var(--bg);
  color: var(--text);
}

/* GitHub-like Dark UI Theme */
:root{
  --bg: #0d1117;
  --bg-muted: #0f141c;
  --panel: #161b22;
  --panel-2: #1c2128;
  --panel-hover: #1f242c;
  --panel-active: #1e2732;
  --text: #c9d1d9;
  --text-strong: #f0f6fc;
  --muted: #8b949e;
  --accent: #2f81f7;
  --accent-2: #1f6feb;
  --accent-hover: #388bfd;
  --danger: #da3633;
  --danger-hover: #f85149;
  --success: #238636;
  --border: #30363d;
  --border-muted: #21262d;
  --shadow: 0 0 0 1px rgba(240,246,252,0.03), 0 6px 12px -2px rgba(0,0,0,0.4), 0 3px 7px rgba(0,0,0,0.4);
  --radius: 6px;
  --radius-lg: 8px;
  --focus-ring: 0 0 0 3px rgba(56,139,253,0.3);
  --font-stack: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
  --mono: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
  --transition: .16s cubic-bezier(.33,1,.68,1);
}

*{ box-sizing: border-box; }
html, body{ height:100%; }
body{
  margin:0;
  font-family: var(--font-stack);
  background: var(--bg);
  color: var(--text);
  -webkit-font-smoothing: antialiased;
}

#app{ display:flex; flex-direction:column; gap:18px; padding:20px 24px; min-height:100vh; }
.top-row{ display:grid; grid-template-columns: 320px 1fr; gap:20px; align-items:stretch; }
.tasks-pane{ display:flex; flex-direction:column; }
.task-pane{ display:flex; flex-direction:column; }
.plan-row{ display:grid; grid-template-columns: 220px 1fr; gap:24px; padding:20px; }
.plan-left{ display:flex; flex-direction:column; gap:10px; }
.plan-right{ display:flex; flex-direction:column; }
.plan-header-inline{ display:flex; flex-direction:column; gap:4px; padding:0 0 6px; border-bottom:1px solid var(--border); margin-bottom:8px; }

@media (max-width: 1100px){
  .plan-row{ grid-template-columns: 180px 1fr; }
}
@media (max-width: 880px){
  .top-row{ grid-template-columns: 1fr; }
  .plan-row{ grid-template-columns: 1fr; }
  .plan-left{ flex-direction:row; flex-wrap:wrap; }
  .plan-shortcuts{ flex-direction:row; flex-wrap:wrap; }
}

.collapse-btn{ display:none !important; }
/* Unified slide-out sidebar toggle (collapse/expand) */
.expand-sidebar-float{ position:fixed; top:6px; left:0; width:34px; height:34px; background:#21262d; border:1px solid var(--border); color:var(--text); border-radius: 0 var(--radius) var(--radius) 0; display:flex; align-items:center; justify-content:center; font-weight:600; font-size:16px; cursor:pointer; z-index:1001; box-shadow: var(--shadow); opacity:0; pointer-events:none; transform: translateX(-120%); transition: transform .25s cubic-bezier(.33,1,.55,1), opacity .2s ease; }
.expand-sidebar-float.visible{ opacity:1; pointer-events:auto; transform: translateX(0); }
.expand-sidebar-float:focus-visible{ outline:none; box-shadow: var(--focus-ring); }

.card{
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow);
  overflow: hidden;
}
.sidebar.card{ background: transparent; box-shadow: none; border:none; }

.sidebar{ display:flex; flex-direction: column; }
.sidebar-header{ padding: 16px 16px 12px; border-bottom: none; }
.sidebar-header-top{ display:flex; align-items:flex-start; justify-content: space-between; gap:12px; }
.sidebar-header-top .icon-btn{ align-self:flex-start; }
.sidebar-header-title{ display:flex; flex-direction:column; gap:2px; }
.header-actions{ display:flex; align-items:flex-start; gap:8px; margin-left:auto; }
.header-actions form{ margin:0; }
.btn.icon-btn{ width:36px; height:36px; display:flex; align-items:center; justify-content:center; font-size:20px; font-weight:600; padding:0; }
.btn.icon-btn:hover{ background: var(--panel-hover); }
.btn.icon-btn:active{ background: var(--panel-active); }
.sidebar-header h1{ margin:0; font-size: 16px; font-weight: 600; letter-spacing: .2px; color: var(--text-strong); }
.row{ display:flex; gap:10px; }
.daily-total{ margin:2px 0 14px; font-size:12px; color: var(--muted); font-family: var(--mono); letter-spacing:.5px; }
.daily-total strong{ color: var(--text-strong); font-weight:600; }
/* Tasks updated today counter */
.updated-today{ margin:2px 0 2px; font-size:11px; color: var(--muted); font-family: var(--mono); letter-spacing:.5px; opacity:.9; }
.updated-today strong{ color: var(--accent); font-weight:600; }

input[type="text"], textarea{
  flex:1; padding: 12px 14px; background: var(--bg-muted); border: 1px solid var(--border-muted); color: var(--text);
  border-radius: var(--radius); outline: none; transition: border .2s ease, box-shadow .2s ease;
}
input[type="text"]:focus, textarea:focus{ border-color: var(--accent); box-shadow: var(--focus-ring); }
textarea{ min-height: 46px; max-height: 240px; resize: vertical; width: 100%; line-height:1.4; font-size:14px; }
#new-update{ resize: none; }

.btn{
  position: relative; background: #21262d; color: var(--text); border: 1px solid var(--border); padding: 6px 14px;
  border-radius: var(--radius); cursor:pointer; font-size: 14px; font-weight: 500; line-height: 1.5;
  transition: background var(--transition), border-color var(--transition), color var(--transition), box-shadow var(--transition);
}
.btn:hover{ background: var(--panel-2); }
.btn:active{ background: var(--panel-active); }
.btn:focus-visible{ outline: none; box-shadow: var(--focus-ring); }
.btn.danger{ background: #2a1211; color: #f0f6fc; }
.btn.danger:hover{ background: var(--danger-hover); border-color: var(--danger-hover); color:#fff; }
.btn.primary{ background: var(--accent-2); color:#fff; border-color: var(--accent-2); }
.btn.primary:hover{ background: var(--accent-hover); border-color: var(--accent-hover); }
.btn.subtle{ background: #1b2129; color: var(--muted); }
.btn.subtle:hover{ color: var(--text); }
.btn.subtle.active{ background: #1f6feb22; color: var(--accent); border-color: var(--accent); }

.task-list{ list-style:none; margin:0; padding:4px 0 8px; overflow:auto; height: calc(100% - 110px); }
.sidebar-body{ flex:1; display:flex; flex-direction:column; overflow:hidden; }
.sidebar-body .task-list{ flex:1; height:auto; }
.sidebar-body{ overflow:auto; }
.task-item{
  border:none; background: transparent; padding: 10px 12px; border-radius: var(--radius); margin: 4px 8px; cursor:pointer;
  transition: background var(--transition), box-shadow var(--transition), border-color var(--transition);
}
.task-item:hover{ background: rgba(255,255,255,0.03); }
.task-item.active{ background: var(--panel-active); border:1px solid var(--accent); box-shadow: 0 0 0 1px var(--accent); }
.task-item-title{ font-weight:600; margin:0 0 4px; font-size:15px; color: var(--text-strong); }
.task-item-preview{ color: var(--muted); font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.task-item-line{ display:flex; align-items:center; gap:8px; }
.task-item-line time.last-update{ margin-left:auto; font-size:11px; color: var(--muted); white-space:nowrap; flex-shrink:0; }
.main{ display:flex; flex-direction: column; }
.empty{ margin:auto; color: var(--muted); }
.hidden{ display:none; }
.task-view{ display:flex; flex-direction: column; height: 100%; }
.task-view-header{ display:flex; align-items:center; justify-content: space-between; padding:12px 16px; border-bottom: 1px solid var(--border); background: var(--panel-2); }
.task-view-header h2{ margin:0; font-size: 16px; font-weight:600; color: var(--text-strong); }
.task-title-block{ display:flex; flex-direction:column; gap:2px; }
.task-daily-total{ margin:2px 0 0; font-size:12px; color: var(--muted); font-family: var(--mono); letter-spacing:.5px; }
.task-daily-total strong{ color: var(--text-strong); font-weight:600; }
.task-desired-outcome{ margin:2px 0 0; font-size:12px; color: var(--muted); line-height:1.3; cursor:pointer; white-space:pre-wrap; overflow-wrap:anywhere; }
.task-desired-outcome.placeholder{ opacity:.55; font-style:italic; }
.task-desired-outcome.editing{ cursor:default; }
.task-desired-outcome.editing input{ width:100%; font-size:12px; line-height:1.3; background: var(--bg-muted); border:1px solid var(--border); color:var(--text); border-radius:4px; padding:4px 6px; font-family:inherit; }
.updates{ list-style:none; margin:0; padding: 12px 16px 16px; overflow:auto; flex:1; display:flex; flex-direction: column; }
/* Default vertical spacing between list children */
.updates > * + *{ margin-top:12px; }
/* Tighter spacing specifically between consecutive time entries */
.updates > .time-entry + .time-entry{ margin-top:4px; }
.update{ background: var(--panel-2); border:1px solid var(--border); border-radius: var(--radius-lg); padding: 12px 12px; }
.update time{ color: var(--muted); font-size: 12px; display:block; margin-top:6px; line-height:1.3; }
.update .update-meta-line{ display:flex; align-items:center; justify-content: space-between; margin-top:6px; gap:8px; }
.update .mini-delete-update{ background:#2a3039; color: var(--muted); border:1px solid var(--border); font-size:12px; padding:2px 8px; border-radius: var(--radius); cursor:pointer; line-height:1.2; }
.update .mini-delete-update:hover{ background:#37404a; color: var(--text); }
.update.editing{ outline: 2px solid rgba(110,168,254,.35); }
.update .edit-row{ display:flex; gap:8px; }
.update .edit-input{ flex:1; padding:10px 12px; border-radius: var(--radius); border:1px solid var(--border); background: var(--bg-muted); color:var(--text); }
.update .edit-textarea{ flex:1; padding:10px 12px; border-radius: var(--radius); border:1px solid var(--border); background: var(--bg-muted); color:var(--text); min-height: 52px; resize: vertical; line-height:1.4; font-size:14px; }
.update .mini-btn{ border:1px solid var(--border); background:#1b2129; padding:6px 10px; border-radius: var(--radius); cursor:pointer; font-weight:500; font-size:12px; color: var(--text); transition: var(--transition); }
.update .mini-btn:hover{ background:#232a33; }
.update .mini-btn.save{ background: var(--accent-2); border-color: var(--accent-2); color:#fff; }
.update .mini-btn.save:hover{ background: var(--accent-hover); border-color: var(--accent-hover); }
.update .mini-btn.cancel{ color: var(--muted); }
.update .mini-btn.cancel:hover{ color: var(--text); }
.update .update-body{ line-height: 1.5; overflow-wrap: anywhere; white-space: pre-wrap; }
/* Override pre-wrap for parsed markdown to avoid rendering raw newline text nodes between list items */
.update .update-body.markdown-body{ white-space: normal; }
.markdown-body{ font-size:14px; line-height:1.5; overflow-wrap:anywhere; }
.markdown-body p{ margin:0 0 6px; }
.markdown-body p:last-child{ margin-bottom:0; }
.markdown-body code{ background:#1f242c; padding:2px 5px; border-radius:4px; font-family: var(--mono); font-size: 12px; }
.markdown-body pre{ background:#1f242c; padding:10px 12px; border-radius:6px; overflow:auto; font-size:13px; line-height:1.4; }
.markdown-body pre code{ background:transparent; padding:0; }
.markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4{ font-weight:600; line-height:1.3; margin:14px 0 8px; }
.markdown-body h1{ font-size:18px; }
.markdown-body h2{ font-size:16px; }
.markdown-body h3{ font-size:15px; }
/* Tighter list spacing */
.markdown-body ul, .markdown-body ol{ padding-left:20px; margin:4px 0 8px; }
.markdown-body li{ margin:0; }
.markdown-body li + li{ margin-top:2px; }
/* Remove paragraph spacing inside list items */
.markdown-body li p{ margin:0; }
.markdown-body blockquote{ margin:8px 0; padding:4px 10px; border-left:4px solid #30363d; color: var(--muted); background:#1b2129; border-radius:4px; }
.markdown-body a{ color: var(--accent); }
.markdown-body hr{ border:0; border-top:1px solid #30363d; margin:14px 0; }
.update a{ color: var(--accent); text-decoration: none; border-bottom: 1px solid rgba(47,129,247,0.4); transition: color var(--transition), border-color var(--transition), background-color var(--transition); }
.update a:hover{ color: var(--accent-hover); border-bottom-color: var(--accent-hover); }
.update a:focus-visible{ outline: none; box-shadow: var(--focus-ring); }
.update a:active{ opacity:.85; }
.update a:visited{ color: var(--accent); }
#new-update-form{ padding: 12px 16px; border-bottom: 1px solid var(--border); background: var(--panel); }

.task-item.closed{ opacity: .6; position: relative; }
.task-item.waiting{ border:1px dashed var(--border); }
.task-item.closed .task-item-title::after{ content: ' • closed'; font-weight:400; color: var(--muted); font-size:11px; }
.task-item.waiting .task-item-title::after{ content: ' • waiting'; font-weight:400; color: var(--accent); font-size:11px; }
.task-actions{ display:flex; gap:8px; align-items:center; }
body.status-closed #task-title{ text-decoration: line-through; opacity: .75; }
body.status-waiting #task-title{ text-shadow: 0 0 6px rgba(110,168,254,.4); }
.time-entry{ background:transparent; border:none; padding:4px 12px; border-radius: var(--radius-lg); font-size:12px; display:flex; }
.time-entry.running{ background:#1d2530; border:1px solid var(--border); box-shadow: inset 0 0 0 1px rgba(35,134,54,0.35); padding:8px 12px; }
.time-entry .te-line{ display:flex; align-items:center; gap:10px; width:100%; }
/* Unified timer control row */
.timer-control-row{ list-style:none; }
.timer-control-btn{ position:relative; display:block; width:100%; background:#238636; border:1px solid #2ea043; color:#fff; font-weight:600; padding:12px 16px 12px 60px; border-radius: var(--radius-lg); cursor:pointer; font-size:14px; font-family: var(--font-stack); text-align:center; }
.timer-control-row.running .timer-control-btn{ background:#da3633; border-color:#f85149; }
.timer-control-btn:hover{ filter:brightness(1.08); }
.timer-control-btn:active{ filter:brightness(.95); }
.timer-duration{ font-family: var(--mono); font-weight:600; font-size:14px; position:absolute; left:20px; top:50%; transform:translateY(-50%); }
.timer-label{ pointer-events:none; }
.time-entry time{ color: var(--muted); font-size:12px; }
.time-entry .te-duration{ font-weight:600; color: var(--text-strong); font-size:12px; font-family: var(--mono); }
.time-entry .te-rel{ color: var(--muted); font-size:12px; }
.time-entry .te-start, .time-entry .te-end{ font-size:12px; color: var(--text); font-family: var(--mono); }
.time-entry .te-colon{ color: var(--muted); font-size:12px; margin:0; }
.time-entry .te-sep{ color: var(--muted); font-size:11px; }
.time-entry .te-left{ color: var(--muted); font-size:11px; margin-left:8px; }
.time-entry .te-delete{ opacity:0; margin-left:6px; background:#2d3540; border:1px solid var(--border); color: var(--muted); font-size:11px; padding:2px 6px; border-radius: var(--radius); cursor:pointer; transition: var(--transition); }
.time-entry:hover .te-delete{ opacity:1; }
.time-entry .te-delete:hover{ background:#3a444f; color: var(--text); }
.time-entry .te-trim{ opacity:0; margin-left:4px; background:#2a3039; border:1px solid var(--border); color: var(--muted); font-size:11px; padding:2px 6px; border-radius: var(--radius); cursor:pointer; transition: var(--transition); }
.time-entry:hover .te-trim{ opacity:1; }
.time-entry .te-trim:hover{ background:#37404a; color: var(--text); }
.btn.subtle.running{ background:#13341e; color: var(--success); border-color: var(--success); }
.update-btn{ background:#238636; border-color:#2ea043; color:#fff; }
.update-btn:hover:not([disabled]){ background:#2ea043; }
.update-btn:active:not([disabled]){ filter:brightness(.92); }
.update-btn[disabled]{ opacity:.45; cursor:not-allowed; filter:none; }

.filter-group{ display:flex; gap:0; margin-top:12px; border:1px solid var(--border); border-radius: var(--radius); overflow:hidden; }
.filter-btn{ flex:1; background: var(--panel); color: var(--muted); border:0; border-right:1px solid var(--border); padding:6px 10px; font-size:12px; font-weight:500; cursor:pointer; transition: var(--transition); }
.filter-btn:last-child{ border-right:0; }
.filter-btn:hover{ background: var(--panel-hover); color: var(--text); }
.filter-btn.active{ background: var(--accent-2); color:#fff; }

@media (max-width: 960px){
  #app{ grid-template-columns: 1fr; padding: 16px; }
  .sidebar{ order:2; height: 46vh; }
  .main{ order:1; height: 50vh; }
}

::-webkit-scrollbar { width: 10px; }
::-webkit-scrollbar-track { background: var(--panel); }
::-webkit-scrollbar-thumb { background: #272e37; border-radius: 20px; border:2px solid var(--panel); }
::-webkit-scrollbar-thumb:hover { background: #313b47; }

/* ---- Daily Plans ---- */
.plans-header{ font-size:11px; font-weight:600; text-transform:uppercase; letter-spacing:.8px; color: var(--muted); margin:0 0 4px; opacity:.85; }
.plan-shortcuts{ list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:6px; }
.plan-shortcuts li{ margin:0; padding:0; }
.plan-shortcut{ width:100%; text-align:left; background: var(--panel-2); border:1px solid var(--border); color: var(--text); padding:6px 10px; border-radius: var(--radius); cursor:pointer; font-size:13px; font-weight:500; display:flex; justify-content: space-between; align-items:center; transition: var(--transition); }
.plan-shortcut .plan-label{ flex:0 0 auto; }
.plan-shortcut .plan-count{ margin-left:8px; }
.plan-shortcut .plan-date{ margin-left:auto; font-family: var(--mono); font-size:11px; color: var(--muted); padding-left:8px; }
.plan-shortcut.active .plan-date{ color:#fff; }
.plan-shortcut:hover{ background: var(--panel-hover); }
.plan-shortcut.active{ background: var(--accent-2); border-color: var(--accent-2); color:#fff; }
.plan-count{ font-family: var(--mono); font-size:11px; color: var(--muted); margin-left:8px; }
.plan-shortcut.active .plan-count{ color:#fff; }

.plan-view{ display:flex; flex-direction:column; height:100%; }
.plan-add-row{ display:flex; gap:10px; padding:12px 16px; border-bottom:1px solid var(--border); background: var(--panel); }
.plan-add-row{ order:3; border-bottom:0; border-top:1px solid var(--border); margin-top:4px; opacity:0; pointer-events:none; transform:translateY(4px); transition: opacity .18s var(--transition), transform .25s var(--transition); background:transparent; padding:10px 0 0; }
.plan-right:hover .plan-add-row{ opacity:1; pointer-events:auto; transform:translateY(0); }
.plan-add-row input{ background: var(--panel-2); }
.plan-add-row input{ flex:1; }
.plan-items{ list-style:none; margin:0; padding:16px; flex:1; overflow:auto; display:flex; flex-direction:column; }
.plan-items > * + *{ margin-top:8px; }
.plan-item{ background: var(--panel-2); border:1px solid var(--border); border-radius: var(--radius); padding:6px 10px; font-size:14px; line-height:1.4; transition: background var(--transition), border-color var(--transition); }
.plan-item{ position:relative; }
.plan-inline-actions{ display:flex; align-items:center; gap:6px; }
.plan-move-actions{ display:none; gap:4px; }
.plan-item:hover .plan-move-actions{ display:flex; }
.plan-move-btn{ background:#1e2530; border:1px solid var(--border); color: var(--accent); font-size:11px; padding:2px 6px; border-radius: var(--radius); cursor:pointer; font-weight:500; }
.plan-move-btn:hover{ background:#26303c; color:#fff; }
.plan-item:hover{ background: var(--panel-hover); }
.plan-item.done{ opacity:.65; }
.plan-item-line{ display:flex; align-items:center; gap:10px; }
.plan-item-line input[type="checkbox"]{ width:16px; height:16px; cursor:pointer; accent-color: var(--accent-2); }
.plan-item-content{ flex:1; overflow-wrap:anywhere; }
.plan-item.done .plan-item-content{ text-decoration: line-through; }
.plan-item-delete{ background:#2a3039; border:1px solid var(--border); color: var(--muted); font-size:12px; padding:2px 6px; border-radius: var(--radius); cursor:pointer; line-height:1.2; }
.plan-item-delete:hover{ background:#37404a; color: var(--text); }
.plan-edit-input{ flex:1; background: var(--bg-muted); border:1px solid var(--border); color: var(--text); border-radius: var(--radius); padding:6px 8px; font-size:14px; }
.plan-empty{ padding:20px 24px; text-align:center; font-size:13px; color: var(--muted); }
.plan-subtitle{ margin:2px 0 0; font-size:12px; color: var(--muted); font-family: var(--mono); letter-spacing:.5px; }
.plan-header{ background: var(--panel-2); }

/* --- Layout Overrides: Fixed bottom daily plan row --- */
#app.fixed-layout, #app{ height:100vh; }
#app{ gap:14px; padding:16px 20px 16px; }
.top-row{ flex:1; overflow:hidden; min-height:0; }
.tasks-pane, .task-pane{ min-height:0; }
.task-list{ flex:1; min-height:0; height:auto !important; }
.plan-row{ flex:0 0 260px; padding:16px 20px; }
.plan-left{ overflow:auto; }
.plan-right{ min-height:0; }
.plan-items{ padding:12px 4px 8px 0; min-height:0; }
@media (max-width:880px){
  .plan-row{ flex:0 0 300px; }
}
